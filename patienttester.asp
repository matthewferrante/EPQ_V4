<%@ LANGUAGE=VBScript %>
<% Option Explicit %>
<!-- #include file="config.asp" -->
<% '$Date: 1/20/06 3:03p $ %>
<%
Session.Contents.Remove("form103_1_1")
Session.Contents.Remove("form103_91_8")
Session.Contents.Remove("form103_91_8a")
Session.Contents.Remove("form103_91_8b")
Session.Contents.Remove("form103_91_8c")
Session.Contents.Remove("form103_91_8d")
Session.Contents.Remove("form103_10_1")
Session.Contents.Remove("form103_10_2")
Session.Contents.Remove("form103_10_3")
Session.Contents.Remove("form103_10_4")
Session.Contents.Remove("form103_10_5")
Session.Contents.Remove("form103_10_6")
Session.Contents.Remove("form103_10_7")
Session.Contents.Remove("form103_10_8")
Session.Contents.Remove("form103_10_9")
Session.Contents.Remove("form103_10_91")
Session.Contents.Remove("form103_10_10")
Session.Contents.Remove("form103_10_11")
Session.Contents.Remove("form103_10_12")
Session.Contents.Remove("form103_10_13")
Session.Contents.Remove("form103_10_14")
Session.Contents.Remove("form103_10_15")
Session.Contents.Remove("form103_10_16")
Session.Contents.Remove("form103_10_17")
Session.Contents.Remove("form103_10_18")
Session.Contents.Remove("form103_10_19")
Session.Contents.Remove("form103_10_20")
Session.Contents.Remove("form103_10_21")
Session.Contents.Remove("form103_10_22")
Session.Contents.Remove("form103_10_221")
Session.Contents.Remove("form103_10_23")
Session.Contents.Remove("form103_10_24")
Session.Contents.Remove("form103_10_25")
Session.Contents.Remove("form103_10_26")
Session.Contents.Remove("form103_10_27")
Session.Contents.Remove("form103_11_1")
Session.Contents.Remove("form103_11_2")
Session.Contents.Remove("form103_11_3")
Session.Contents.Remove("form103_11_4")
Session.Contents.Remove("form103_11_5")
Session.Contents.Remove("form103_11_6")
Session.Contents.Remove("form103_11_7")
Session.Contents.Remove("form103_11_8")
Session.Contents.Remove("form103_11_9")
Session.Contents.Remove("form103_11_91")
Session.Contents.Remove("form103_11_10")
Session.Contents.Remove("form103_11_11")
Session.Contents.Remove("form103_11_12")
Session.Contents.Remove("form103_11_13")
Session.Contents.Remove("form103_11_14")
Session.Contents.Remove("form103_11_15")
Session.Contents.Remove("form103_11_16")
Session.Contents.Remove("form103_11_17")
Session.Contents.Remove("form103_female_2")
Session.Contents.Remove("form103_female_6")
Session.Contents.Remove("form103_female_7")
Session.Contents.Remove("form103_female_8")
Session.Contents.Remove("form103_female_9")
Session.Contents.Remove("form103_11_18")
Session.Contents.Remove("form103_11_19")
Session.Contents.Remove("form103_11_20")
Session.Contents.Remove("form103_11_211")
Session.Contents.Remove("form103_11_21")
Session.Contents.Remove("form103_11_22")
Session.Contents.Remove("form103_11_23")
Session.Contents.Remove("form103_11_24")
Session.Contents.Remove("form103_11_25")
Session.Contents.Remove("form103_11_26")
Session.Contents.Remove("form103_11_27")
Session.Contents.Remove("form103_11_28")
Session.Contents.Remove("form103_11_29")
Session.Contents.Remove("form103_11_30")
Session.Contents.Remove("form103_12_1")
Session.Contents.Remove("form103_12_2")
Session.Contents.Remove("form103_12_3")
Session.Contents.Remove("form103_12_4")
Session.Contents.Remove("form103_12_5")
Session.Contents.Remove("form103_12_6")
Session.Contents.Remove("form103_12_7")
Session.Contents.Remove("form103_12_71")
Session.Contents.Remove("form103_12_8")
Session.Contents.Remove("form103_12_9")
Session.Contents.Remove("form103_12_10")
Session.Contents.Remove("form103_12_11")
Session.Contents.Remove("form103_12_12")
Session.Contents.Remove("form103_12_13")
Session.Contents.Remove("form103_12_15")
Session.Contents.Remove("form103_12_14")
Session.Contents.Remove("form103_12_16")
Session.Contents.Remove("form103_12_17")
Session.Contents.Remove("form103_12_18")
Session.Contents.Remove("form103_12_19")
Session.Contents.Remove("form103_12_20")
Session.Contents.Remove("form103_13_1")
Session.Contents.Remove("form103_13_2")
Session.Contents.Remove("form103_13_3")
Session.Contents.Remove("form103_13_4")
Session.Contents.Remove("form103_13_5")
Session.Contents.Remove("form103_13_6")
Session.Contents.Remove("form103_13_7")
Session.Contents.Remove("form103_13_8")
Session.Contents.Remove("form103_13_9")
Session.Contents.Remove("form103_13_3a")
Session.Contents.Remove("form103_13_4a")
Session.Contents.Remove("form103_13_5a")
Session.Contents.Remove("form103_13_2a")
Session.Contents.Remove("form103_13_1a")
Session.Contents.Remove("form103_13_9a")
Session.Contents.Remove("form103_14_1")
Session.Contents.Remove("form103_4_1")
Session.Contents.Remove("form103_4_2")
Session.Contents.Remove("form103_4_3")
Session.Contents.Remove("form103_4_4")
Session.Contents.Remove("form103_5_1")
Session.Contents.Remove("form103_5_2")
Session.Contents.Remove("form103_5_3")
Session.Contents.Remove("form103_5_4")
Session.Contents.Remove("form103_5_5")
Session.Contents.Remove("form103_5_6")
Session.Contents.Remove("form103_5_7")
Session.Contents.Remove("form103_5_8")
Session.Contents.Remove("form103_5_9")
Session.Contents.Remove("form103_5_10")
Session.Contents.Remove("form103_5_11")
Session.Contents.Remove("form103_5_12")
Session.Contents.Remove("form103_5_13")
Session.Contents.Remove("form103_5_14")
Session.Contents.Remove("form103_5_15")
Session.Contents.Remove("form103_5_16")
Session.Contents.Remove("form103_5_17")
Session.Contents.Remove("form103_5_18")
Session.Contents.Remove("form103_5_19")
Session.Contents.Remove("form103_5_20")
Session.Contents.Remove("form103_5_21")
Session.Contents.Remove("form103_5_22")
Session.Contents.Remove("form103_5_23")
Session.Contents.Remove("form103_5_24")
Session.Contents.Remove("form103_5_25")
Session.Contents.Remove("form103_5_26")
Session.Contents.Remove("form103_5_27")
Session.Contents.Remove("form103_5_28")
Session.Contents.Remove("form103_5_29")
Session.Contents.Remove("form103_5_29specify")

Session.Contents.Remove("form103_5_30")
Session.Contents.Remove("form103_5_31")
Session.Contents.Remove("form103_5_32")
Session.Contents.Remove("form103_5_33")
Session.Contents.Remove("form103_5_34")
Session.Contents.Remove("form103_5_35")
Session.Contents.Remove("form103_5_36")
Session.Contents.Remove("form103_6_1")
Session.Contents.Remove("form103_6_1")
Session.Contents.Remove("form103_6_2")
Session.Contents.Remove("form103_6_3")
Session.Contents.Remove("form103_6_4")
Session.Contents.Remove("form103_6_5")
Session.Contents.Remove("form103_6_6")
Session.Contents.Remove("form103_6_7")
Session.Contents.Remove("form103_6_8")
Session.Contents.Remove("form103_7_1")
Session.Contents.Remove("form103_7_1a")
Session.Contents.Remove("form103_7_1b")
Session.Contents.Remove("form103_7_2")
Session.Contents.Remove("form103_7_2a")
Session.Contents.Remove("form103_7_2b")
Session.Contents.Remove("form103_7_3")
Session.Contents.Remove("form103_7_3a")
Session.Contents.Remove("form103_7_3b")
Session.Contents.Remove("form103_7_4")
Session.Contents.Remove("form103_7_4a")
Session.Contents.Remove("form103_7_4b")
Session.Contents.Remove("form103_7_5")
Session.Contents.Remove("form103_7_5a")
Session.Contents.Remove("form103_7_5b")
Session.Contents.Remove("form103_7_6")
Session.Contents.Remove("form103_7_6a")
Session.Contents.Remove("form103_7_6b")
Session.Contents.Remove("form103_7_7")
Session.Contents.Remove("form103_7_7a")
Session.Contents.Remove("form103_7_7b")
Session.Contents.Remove("form103_7_8")
Session.Contents.Remove("form103_7_8a")
Session.Contents.Remove("form103_7_8b")
Session.Contents.Remove("form103_91_1")
Session.Contents.Remove("form103_91_1a")
Session.Contents.Remove("form103_91_2")
Session.Contents.Remove("form103_91_2a")
Session.Contents.Remove("form103_91_3")
Session.Contents.Remove("form103_91_3a")
Session.Contents.Remove("form103_91_4")
Session.Contents.Remove("form103_91_4a")
Session.Contents.Remove("form103_91_5")
Session.Contents.Remove("form103_91_5a")
Session.Contents.Remove("form103_91_6")
Session.Contents.Remove("form103_91_6a")
Session.Contents.Remove("form103_91_7")
Session.Contents.Remove("form103_13_1")
Session.Contents.Remove("form103_13_1a")
Session.Contents.Remove("form103_13_2")
Session.Contents.Remove("form103_13_2a")
Session.Contents.Remove("form103_13_3")
Session.Contents.Remove("form103_13_3a")
Session.Contents.Remove("form103_13_4")
Session.Contents.Remove("form103_13_4a")
Session.Contents.Remove("form103_13_5")
Session.Contents.Remove("form103_13_5a")
Session.Contents.Remove("form103_13_6")
Session.Contents.Remove("form103_13_7")
Session.Contents.Remove("form103_13_9")
Session.Contents.Remove("form103_13_9a")
Session.Contents.Remove("form103_13_8")
Session.Contents.Remove("form103_13_8a")
Session.Contents.Remove("form103_8_1")
Session.Contents.Remove("form103_8_1a")
Session.Contents.Remove("form103_8_1b")
Session.Contents.Remove("form103_8_1c")
Session.Contents.Remove("form103_8_1d")
Session.Contents.Remove("form103_8_2")
Session.Contents.Remove("form103_8_2a")
Session.Contents.Remove("form103_8_2b")
Session.Contents.Remove("form103_8_2c")
Session.Contents.Remove("form103_8_2d")
Session.Contents.Remove("form103_8_3")
Session.Contents.Remove("form103_8_3a")
Session.Contents.Remove("form103_8_3b")
Session.Contents.Remove("form103_8_3c")
Session.Contents.Remove("form103_8_3d")
Session.Contents.Remove("form103_8_4")
Session.Contents.Remove("form103_8_4a")
Session.Contents.Remove("form103_8_4b")
Session.Contents.Remove("form103_8_4c")
Session.Contents.Remove("form103_8_4d")
Session.Contents.Remove("form103_8_5")
Session.Contents.Remove("form103_8_5a")
Session.Contents.Remove("form103_8_5b")
Session.Contents.Remove("form103_8_5c")
Session.Contents.Remove("form103_8_5d")
Session.Contents.Remove("form103_8_6")
Session.Contents.Remove("form103_8_6a")
Session.Contents.Remove("form103_8_6b")
Session.Contents.Remove("form103_8_6c")
Session.Contents.Remove("form103_8_6d")
Session.Contents.Remove("form103_8_7")
Session.Contents.Remove("form103_8_7a")
Session.Contents.Remove("form103_8_7b")
Session.Contents.Remove("form103_8_7c")
Session.Contents.Remove("form103_8_7d")
Session.Contents.Remove("form103_8_8")
Session.Contents.Remove("form103_8_8a")
Session.Contents.Remove("form103_8_8b")
Session.Contents.Remove("form103_8_8c")
Session.Contents.Remove("form103_8_8d")
Session.Contents.Remove("form103_8_9")
Session.Contents.Remove("form103_8_9a")
Session.Contents.Remove("form103_8_9b")
Session.Contents.Remove("form103_8_9c")
Session.Contents.Remove("form103_8_9d")
Session.Contents.Remove("form103_8_10")
Session.Contents.Remove("form103_8_10a")
Session.Contents.Remove("form103_8_10b")
Session.Contents.Remove("form103_8_10c")
Session.Contents.Remove("form103_8_10d")
Session.Contents.Remove("form103_8_11")
Session.Contents.Remove("form103_8_11a")
Session.Contents.Remove("form103_8_11b")
Session.Contents.Remove("form103_8_11c")
Session.Contents.Remove("form103_8_11d")
Session.Contents.Remove("form103_8_12")
Session.Contents.Remove("form103_8_12a")
Session.Contents.Remove("form103_8_12b")
Session.Contents.Remove("form103_8_12c")
Session.Contents.Remove("form103_8_12d")
Session.Contents.Remove("form103_9_1")
Session.Contents.Remove("form103_9_1a")
Session.Contents.Remove("form103_9_2")
Session.Contents.Remove("form103_9_2a")
Session.Contents.Remove("form103_9_3")
Session.Contents.Remove("form103_9_3a")
Session.Contents.Remove("form103_9_4")
Session.Contents.Remove("form103_9_4a")
Session.Contents.Remove("form103_9_5")
Session.Contents.Remove("form103_9_5a")
Session.Contents.Remove("form103_9_6")
Session.Contents.Remove("form103_9_6a")
Session.Contents.Remove("form103_9_7")
Session.Contents.Remove("form103_9_7a")
Session.Contents.Remove("form103_9_8")
Session.Contents.Remove("form103_9_8a")
Session.Contents.Remove("form103_9_9")
Session.Contents.Remove("form103_9_9a")
Session.Contents.Remove("form103_9_10")
Session.Contents.Remove("form103_9_10a")
Session.Contents.Remove("form103_9_11")
Session.Contents.Remove("form103_9_11a")
Session.Contents.Remove("form103_9_12")
Session.Contents.Remove("form103_9_12a")
Session.Contents.Remove("form103_9_13")
Session.Contents.Remove("form103_9_13a")
Session.Contents.Remove("form103_9_14")
Session.Contents.Remove("form103_9_14a")
Session.Contents.Remove("form103_9_15")
Session.Contents.Remove("form103_9_15a")
Session.Contents.Remove("form103_cancer_1father")
Session.Contents.Remove("form103_cancer_1mother")
Session.Contents.Remove("form103_cancer_1brother")
Session.Contents.Remove("form103_cancer_1sister")
Session.Contents.Remove("form103_cancer_1grandfather")
Session.Contents.Remove("form103_cancer_1grandmother")
Session.Contents.Remove("form103_cancer_1grandother")
Session.Contents.Remove("form103_cancer_2father")
Session.Contents.Remove("form103_cancer_2mother")
Session.Contents.Remove("form103_cancer_2brother")
Session.Contents.Remove("form103_cancer_2sister")
Session.Contents.Remove("form103_cancer_2grandfather")
Session.Contents.Remove("form103_cancer_2grandmother")
Session.Contents.Remove("form103_cancer_2grandother")
Session.Contents.Remove("form103_cancer_3father")
Session.Contents.Remove("form103_cancer_3mother")
Session.Contents.Remove("form103_cancer_3brother")
Session.Contents.Remove("form103_cancer_3sister")
Session.Contents.Remove("form103_cancer_3grandfather")
Session.Contents.Remove("form103_cancer_3grandmother")
Session.Contents.Remove("form103_cancer_3grandother")
Session.Contents.Remove("form103_cancer_4father")
Session.Contents.Remove("form103_cancer_4mother")
Session.Contents.Remove("form103_cancer_4brother")
Session.Contents.Remove("form103_cancer_4sister")
Session.Contents.Remove("form103_cancer_4grandfather")
Session.Contents.Remove("form103_cancer_4grandmother")
Session.Contents.Remove("form103_cancer_4grandother")
Session.Contents.Remove("form103_cancer_5father")
Session.Contents.Remove("form103_cancer_5mother")
Session.Contents.Remove("form103_cancer_5brother")
Session.Contents.Remove("form103_cancer_5sister")
Session.Contents.Remove("form103_cancer_5grandfather")
Session.Contents.Remove("form103_cancer_5grandmother")
Session.Contents.Remove("form103_cancer_5grandother")
Session.Contents.Remove("form103_cancer_6father")
Session.Contents.Remove("form103_cancer_6mother")
Session.Contents.Remove("form103_cancer_6brother")
Session.Contents.Remove("form103_cancer_6sister")
Session.Contents.Remove("form103_cancer_6grandfather")
Session.Contents.Remove("form103_cancer_6grandmother")
Session.Contents.Remove("form103_cancer_6grandother")
Session.Contents.Remove("form103_1_2")
Session.Contents.Remove("form103_1_3")
Session.Contents.Remove("form103_1_4")
Session.Contents.Remove("form103_1_5")
Session.Contents.Remove("form103_1_6")
Session.Contents.Remove("form103_2_1")
Session.Contents.Remove("form103_2_2")
Session.Contents.Remove("form103_2_3")
Session.Contents.Remove("form103_2_7")
Session.Contents.Remove("form103_2_8")
Session.Contents.Remove("form103_2_41")
Session.Contents.Remove("form103_2_42")
Session.Contents.Remove("form103_2_43")
Session.Contents.Remove("form103_2_5")
Session.Contents.Remove("form103_2_6")
Session.Contents.Remove("SmokingType")
Session.Contents.Remove("form103_3_1")
Session.Contents.Remove("form103_3_2")
Session.Contents.Remove("form103_3_3")
Session.Contents.Remove("form103_3_4")
Session.Contents.Remove("form103_3_5")
Session.Contents.Remove("form103_3_6")
Session.Contents.Remove("form103_3_7")
Session.Contents.Remove("form103_3_8")
Session.Contents.Remove("form103_3_9")
Session.Contents.Remove("form103_3_10")

dim strConnection
	strConnection="DRIVER={SQL Server};SERVER=formedicmhq\sqlexpress;UID=orhs;PWD=orhs1;DATABASE=PatientHL"

dim strFirstName
dim strMiddleInitial
dim strLastName
dim strName
%>

<% '$Revision: 3 $ %>
<head>
<link rel="meta" href="http://www.ihealthinterview.com/labels.xml" type="application/rdf+xml" title="ICRA labels" />
<meta http-equiv="pics-Label" content='(pics-1.1 "http://www.icra.org/pics/vocabularyv03/" l gen true for "http://ihealthinterview.com" r (n 0 s 0 v 0 l 0 oa 0 ob 0 oc 0 od 0 oe 0 of 0 og 0 oh 0 c 0) gen true for "http://www.ihealthinterview.com" r (n 0 s 0 v 0 l 0 oa 0 ob 0 oc 0 od 0 oe 0 of 0 og 0 oh 0 c 0))' />
</head>
<%

'dim enterProviderID
dim strPatientIDLabel
dim strPatientIDPrefix
dim SpanishInterviewSet
dim PID18
dim PID2
dim PV7
dim PV10
dim strHomeAreaCode
dim strHomePrefix
dim strHomeBody
dim strHomePhoneNumber
dim strAPPTMonth
dim strAPPTDay
dim strAPPTYear
dim strAppointmentDate
dim strAppointmentDate2

dim AppointmentGap
dim AppointmentGap2
dim ErrorCount

'enterProviderID = Session("EnterProviderID")
'strPatientIDLabel = "PV7 ID Value for MD"
'strPatientIDPrefix = Session("PatientIDPrefix")

dim bInputPatientSSN
if Session("InputPatientSSN") = 1 then
	bInputPatientSSN = true
else
	bInputPatientSSN = false
end if


if Request.Form("ispostback") = 1 then
Session("StatusMsg")=""
Session("StatusMsgTooClose")=""
Session("StatusMsgTooFar")=""

	Dim strError
	strError = ""

	' Patient ID
	dim strPatientID
	strPatientID = Request.Form("txtPatientID")
'	Session("ProviderID")=strPatientID

	' Name


	'strLastName = Request.Form("txtLastName")
	'strFirstName = Request.Form("txtFirstName")
	'Session("LastName") = Request.Form("txtLastName")
	'Session("FirstName")= Request.Form("txtFirstName")

	strDOBDay = Request.Form("txtDOBDay")
	strDOBMonth = Request.Form("txtDOBMonth")
	strDOBYear = Request.Form("txtDOBYear")

	'Session("strDOBDay")=strDOBDay
	'Session("strDOBMonth")=strDOBMonth
	'Session("strDOBYear")=strDOBYear

	strAPPTDay = Request.Form("txtAPPTDay")
	strAPPTMonth = Request.Form("txtAPPTMonth")
	strAPPTYear = Request.Form("txtAPPTYear")

	Session("strAPPTDay")=strAPPTDay
	Session("strAPPTMonth")=strAPPTMonth
	Session("strAPPTYear")=strAPPTYear

if Session("strAPPTYear")="" then
strApptYear="2000"
end if
if Session("strAPPTMonth")="" then
strApptMonth="06"
end if

if Session("strAPPTDay")="" then
strApptDay="01"
end if

Session("strAppointmentDate2")=strAPPTMonth&"/"&strAPPTDay&"/"&strAPPTYear

Session("strAppointmentDate")=strAPPTYear&strAPPTMonth&strAPPTDay
strAppointmentDate=strAPPTYear&strAPPTMonth&strAPPTDay

	strHomeAreaCode=Request.Form("txtHomeAreaCode")
	strHomePrefix=Request.Form("txtHomePrefix")
	strHomeBody=Request.Form("txtHomeBody")

	Session("strHomeAreaCode")=strHomeAreaCode
	Session("strHomePrefix")=strHomePrefix
	Session("strHomeBody")=strHomeBody


	strHomePhoneNumber=strHomeAreaCode&strHomePrefix&strHomeBody
	Session("strHomePhoneNumber")=strHomeAreaCode&strHomePrefix&strHomeBody

dim aFSODemo
set aFSODemo = Server.CreateObject("Scripting.FileSystemObject")


dim strPatientDemoFilename
strPatientDemoFilename="c:\websites\patientcenter\officefolders\hmglognumbers.txt"



dim strDemographics2
strDemographics2 = left(now(),15)&","&session("strHomePhoneNumber")&","&Session("strApptMonth")&"/"& Session("strApptDay")&"/"&Session("strApptYear")&" "&Request.ServerVariables("http_user_agent")&", "&Request.ServerVariables("remote_addr")&chr(&H0d)

dim demoFile
set demoFile = aFSODemo.OpenTextFile (strPatientDemoFilename, 8, True)
demoFile.write strDemographics2
demoFile.Close


	strMiddleInitial = Request.Form("txtMiddleInitial")

'Confirm Unique
														dim strSQLUnique
														dim strSQLUnique2

														dim dbConnectUnique

														'strSQLUnique = "select COUNT(*) AS '"& """&"TotalPatients"&"""&" from LOGIN WHERE LastName= '" & strLastName & "'"


strSQLUnique = "select COUNT(DISTINCT FirstName) AS TotalPatients from LOGIN WHERE HomeNumber= '" & strHomePhoneNumber & "' AND AppointmentDate2= '" & strAppointmentDate& "'"



														set dbConnectUnique = Server.CreateObject("adodb.connection")
														dbConnectUnique.ConnectionString = strConnection

														dbConnectUnique.Open

														dim rsLastNameUnique
														dim rsLastNameCountUnique
														set rsLastNameUnique = Server.CreateObject("adodb.recordset")
														rsLastNameUnique.open strSQLUnique, dbConnectUnique


   If not rsLastNameUnique.EOF Then
		dim PatientCount
		Session("PatientCount") = rsLastNameUnique("TotalPatients")
   End If


if Session("PatientCount") > 1 then
Session("DuplicateFound")=1
Session("StatusMsg2") = "We have found more than one appointment.  Please enter your First Name."

Response.Redirect "patient3.asp"

else
end if

'CONFIRM +30 or -1

										'				dbConnectUnique.Close


AppointmentGap= "select DATEDIFF(day, '"&Session("strAppointmentDate2")&"', GETDATE()) AS CheckAppointment from LOGIN WHERE HomeNumber= '" & strHomePhoneNumber & "' AND AppointmentDate2= '" & strAppointmentDate& "'"
'AppointmentGap= "select DATEDIFF(day, '2005-05-29 10:10:03.001'', GETDATE()) AS Expr1 WHERE HomeNumber = '"&strHomePhoneNumber&"'"

														set dbConnectUnique = Server.CreateObject("adodb.connection")
														dbConnectUnique.ConnectionString = strConnection

														dbConnectUnique.Open

														dim rsLastNameUnique2
														dim rsLastNameCountUnique2
														set rsLastNameUnique2 = Server.CreateObject("adodb.recordset")
														rsLastNameUnique2.open AppointmentGap, dbConnectUnique



If not rsLastNameUnique2.EOF Then
		Session("AppointmentGap2") = rsLastNameUnique2("CheckAppointment")

else
		Session("AppointmentGap2") = "unknown"
end if


if Session("AppointmentGap2") <> "unknown" then
if Session("AppointmentGap2") < -30 then
Session("DuplicateFound")=1
Session("ErrorCode")=1
Session("StatusMsgTooFar") = "Your Appointment is "&abs(Session("AppointmentGap2"))&" days away. We kindly ask you to complete this form within 30 days of your appointment."
Session("StatusMsg")=""
Session("StatusMsgTooClose")=""
Response.Redirect "patient.asp"

else
end if

if Session("AppointmentGap2") >  1 then
Session("DuplicateFound")=1
Session("ErrorCode")=1
Session("StatusMsgTooClose") = "Your Appointment was more than one day ago. We kindly ask you to complete this form 30 days prior to your next appointment."

Session("StatusMsg")=""
Session("StatusMsgTooFar")=""

Response.Redirect "patient.asp"

else
end if
end if

														dbConnectUnique.Close

														' Get all the providers from the db
														dim strSQL
														dim dbConnect



														strSQL = "select * from LOGIN WHERE HomeNumber= '" & strHomePhoneNumber& "' AND AppointmentDate2= '" & strAppointmentDate& "'"


														set dbConnect = Server.CreateObject("adodb.connection")
														dbConnect.ConnectionString = strConnection
														dbConnect.Open

														dim rsLastName
														set rsLastName = Server.CreateObject("adodb.recordset")
														rsLastName.open strSQL, dbConnect

if not rsLastName.eof then

														do until rsLastName.EOF
															dim idCustomer
															dim strItem
															idCustomer = rsLastName("ExternalID")

															strItem = rsLastName("LastName")&rsLastName("FirstName")
															strItem = strItem &rsLastName("ExternalID")&","
															strItem = strItem &rsLastName("InternalID")&","
															strItem = strItem &rsLastName("AccountNumber")&","
															strItem = strItem &rsLastName("HospitalService")&","
															strItem = strItem &rsLastName("Location")&","
															strItem = strItem &rsLastName("AttendingDoctor")&","
															strItem = strItem &rsLastName("Sex")&","
															strItem = strItem &rsLastName("AppointmentDate2")&","
															strItem = strItem &rsLastName("HomeNumber")

Session("strLastName")=rsLastName("LastName")
Session("strFirstName")=rsLastName("FirstName")
Session("FirstName")=strFirstName
Session("MiddleInitial")=strMiddleInitial
Session("MessageTime")=rsLastName("MessageTime")
Session("PID2")=rsLastName("ExternalID")
Session("PID3")=rsLastName("InternalID")
Session("PID18") = rsLastName("AccountNumber")
Session("PV7") = rsLastName("AttendingDoctor")
Session("PV10") =rsLastName("HospitalService")
Session("Location") =rsLastName("Location")
Session("HomeNumber") = rsLastName("HomeNumber")
Session("strGender") = rsLastName("Sex")
Session("strDOB") = rsLastName("DOB")
Session("LastName")=rsLastName("LastName")
Session("strLastName")=rsLastName("LastName")
Session("FirstName")=rsLastName("FirstName")

Session("strDOBYear")=Left(Session("strDOB"),4)
Session("strDOBDay")=Right(Session("strDOB"),2)
Session("strDOBMonth")=Mid(Session("strDOB"),5,2)

													rsLastName.MoveNext
														loop

Session("MatchFound")=1
														rsLastName.Close



														dbConnect.Close
														set rsLastName = nothing
														set dbConnect = nothing



	' Validate gender.
	dim strGender
	dim maleChecked
	dim femaleChecked

if len(Session("PV7"))>0 then
else
	Session("PV7")= "005275"
end if

	' Date of birth
	dim strDOBDay
	dim strDOBMonth
	dim strDOBYear

	strDOBDay = Request.Form("txtDOBDay")
	strDOBMonth = Request.Form("txtDOBMonth")
	strDOBYear = Request.Form("txtDOBYear")

	'Session("strDOBDay")=strDOBDay
	'Session("strDOBMonth")=strDOBMonth
	'Session("strDOBYear")=strDOBYear
	'Session("strLastName")=strLastName

	if len(strError) = 0 then
		if strDOBMonth = "" or strDOBDay = "" or strDOBYear = "" then
			strError = "Please enter a month, day, and year for date of birth."
		end if
	end if

	dim dobMonth
	dim dobDay
	dim dobYear

	dobMonth = 0
	dobDay = 0
	dobYear = 0

	if IsNumeric(strDOBMonth) then
		dobMonth = CInt(strDOBMonth)
	end if

	if IsNumeric(strDOBDay) then
		dobDay = CInt(strDOBDay)
	end if

	if IsNumeric(strDOBYear) then
		dobYear = CInt(strDOBYear)
	end if

	if len(strError) = 0 then
		if dobMonth < 1 or dobMonth > 12 then
			strError = "Please enter a number from 1 to 12 for the month."
		end if
	end if

	if len(strError) = 0 then
		if dobDay < 1 or dobDay > 31 then
			strError = "Please enter a number from 1 to 31 for the day."
		end if
	end if

	if len(strError) = 0 then
		if dobYear < 1900 or dobYear > 2100 then
			strError = "Please enter a valid number for the year. Use 4 digits for the year (ex: 1960)."
		end if
	end if

	if len(strError) = 0 then
		dim dateCheck
		dateCheck = CStr(dobMonth) + "/" + CStr(dobDay) + "/" + CStr(dobYear)
		if isDate(dateCheck) then
		else
			strError = "There is an error with the date of birth. Please correct the month, day, or year and try again."
		end if
	end if


	if len(strError) = 0 then
		Dim aPTQWebScreening
		set aPTQWebScreening = Session("PTQWebScreening")

		aPTQWebScreening.Logon
		if Err.number > 0 then
			strError = "An unexpected initialization error has occurred. Unable to logon. Error code:" & Err.number & ". Please contact your provider."
		end if

	If Request.Form("SpanishInterview")= "Yes" then
		Session("CurrentLanguage")= 2058
	end if

		Dim langID
		langID = Session("CurrentLanguage")
		if (langID = 0) then
			langID = 1033  ' English
		end if

		aPTQWebScreening.SetLanguage(langID)
		if Err.number > 0 then
			strError = "An unexpected initialization error has occurred. Unable to set language. Error code:" & Err.number & ". Please contact your provider."
		end if

		if len(strPatientID) > 0 then
			aPTQWebScreening.PatientID = strPatientIDPrefix + strPatientID
			aPTQWebScreening.PatientID = Session("PID18")
		end if

		Err.number = 0
		aPTQWebScreening.PatientFirstName = strFirstName
		aPTQWebScreening.PatientMiddleName = strMiddleInitial
		aPTQWebScreening.PatientLastName = strLastName

		Err.number=0
		aPTQWebScreening.PatientGender = Session("strGender")
		if Err.number > 0 then
			strError = "An unexpected initialization error has occurred. Invalid gender specified. Error code:" & Err.number & ". Please contact your provider."
		end if

		Err.number=0
		aPTQWebScreening.SetPatientDOB dobMonth, dobDay, dobYear
		if Err.number > 0 then
			strError = "An unexpected initialization error has occurred. Unable to set date of birth. Error code:" & Err.number & ". Please contact your provider."
		end if


		if len(strError) <> 0 then
			aPTQWebScreening.Logoff
		end if
	end if


		Response.Redirect "patient2.asp"

else
	Session("StatusMsg") = "We have not found your appointment.  Please double-check the information and try again."
	Session("ErrorCode")=1

	Session("ErrorCount")=	Session("ErrorCount")+1
	If Session("ErrorCount") > 1 then 
	Session("StatusMsg") = "We have not found your appointment.  Please check with your physician's office."
	end if

	Session("MatchFound")=0
	Session("DuplicateFound")=0


	If Session("ErrorCount") > 1 then 
	Response.Redirect "patient3.asp"
	end if

	Response.Redirect "patient.asp"

end if

	if len(strError) = 0 then
		set aPTQWebScreening = Nothing
		Session("PatientsName") = strName

		if Session("InputPatientType") = "1" then
'			Response.Redirect "patienttype.asp"
		elseif Session("InputPatientDemographics") = "1" then
'			Response.Redirect "patientdemographics.asp"
		else
'			Response.Redirect "pickprovider.asp"
		end if
	end if
else
	Session("PatientsName") = ""
end if
%>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<meta name="vs_targetSchema" content="http://schemas.microsoft.com/intellisense/ie5">
		<title><%=i_strBrowserTitle%></title>
		<link href="main.css" type="text/css" rel="stylesheet">
		<script type="text/javascript">
			function autotab(original,destination){
			if (original.getAttribute&&original.value.length==original.getAttribute("maxlength"))
			destination.focus()
			}

			function setFocus()
			{
				document.formPatient.txtFirstName.focus();
			}
		</script>

	</head>
	<body onload="setFocus()">
		<form name="formPatient" action="patient.asp" method="POST" id="formPatient">
		<input type="hidden" name="ispostback" value="1" ID="Hidden1">
		<table class="SiteHeader" ID="Table1">
			<table class="SiteBody" ID="Table2">
				<tr class="SiteBody">
					<td>
						<table class="StatusDialog" align="center" cellpadding="0" cellspacing="0" ID="Table3">
							<tr>
								<td valign="top">
									<table class="DialogTitle" ID="Table4">
										<tr class="StatusDialogTitle">
											<td class="DialogText">Enter Patient Information</td>
										</tr>
									</table>
									<table class="DialogContent" ID="Table5">
										<tr class="StatusDialogContent">
											<td valign="top">
												
	<%
	if Session("ErrorCode")<>1 then
	%>
											<p>Please enter your information and click Next.</p>
	<%
	end if
	%>
											<p>
											<table>
<font color="red">
<%
=	Session("StatusMsg")
%>
<%
=	Session("StatusMsgTooClose")
%>
<%
=	Session("StatusMsgTooFar")
%>
</font>



												<tr>
													<td><b>Home Phone Number</b></td>
													<td>(<input id="txtHomeAreaCode" type="text" size="2" onKeyup="autotab(this, document.formPatient.txtHomePrefix)" maxlength="3" value="<%=strHomeAreaCode%>" name="txtHomeAreaCode">)
													<input id="txtHomePrefix" type="text" size="2" onKeyup="autotab(this, document.formPatient.txtHomeBody)" maxlength="3" value="<%=strHomePrefix%>" name="txtHomePrefix">-
													<input id="txtHomeBody" type="text" size="3" onKeyup="autotab(this, document.formPatient.txtAPPTMonth)" maxlength="4" value="<%=strHomeBody%>" name="txtHomeBody"> </td>
												</tr>


												<tr>
													<td><b>Date of Appointment</b></td>
													<td>&nbsp;</td>
												</tr>
												<tr>
													<td>&nbsp;&nbsp;Month</td>

						<td><select id="txtAPPTMonth" size="1" name="txtAPPTMonth" size="1">
                                        <option> </option>
<option value="01">Jan</option>
<option value="02">Feb</option>
<option value="03">Mar</option>
<option value="04">Apr</option>
<option value="05">May</option>
<option value="06">June</option>
<option value="07">July</option>
<option value="08">Aug</option>
<option value="09">Sept</option>
<option value="10">Oct</option>
<option value="11">Nov</option>
<option value="12">Dec</option>


                                      </select></td>


												</tr>
												<tr>
													<td>&nbsp;&nbsp;Day</td>
						<td><select id="txtAPPTDay" size="1" name="txtAPPTDay" size="1">
                                        <option> </option>
<option value="01">01</option>
<option value="02">02</option>
<option value="03">03</option>
<option value="04">04</option>
<option value="05">05</option>
<option value="06">06</option>
<option value="07">07</option>
<option value="08">08</option>
<option value="09">09</option>
<option value="10">10</option>
<option value="11">11</option>
<option value="12">12</option>
<option value="13">13</option>
<option value="14">14</option>
<option value="15">15</option>
<option value="16">16</option>
<option value="17">17</option>
<option value="18">18</option>
<option value="19">19</option>
<option value="20">20</option>
<option value="21">21</option>
<option value="22">22</option>
<option value="23">23</option>
<option value="24">24</option>
<option value="25">25</option>
<option value="26">26</option>
<option value="27">27</option>
<option value="28">28</option>
<option value="29">29</option>
<option value="30">30</option>
<option value="31">31</option>


                                      </select></td>

												</tr>
												<tr>

													<td>&nbsp;&nbsp;Year</td>

						<td><select id="txtAPPTYear" size="1" name="txtAPPTYear" size="1">
                                        <option> </option>
<option selected value="2012">2012</option>
</select>
												</tr>

									<table class="DialogCommands" ID="Table6">
									<tr class="StatusDialogCommands">
									<td><button id="btnNext" type="submit" class="DialogCommand">Next</button></td>
<%
if Session("ErrorCode")=1 then
%>
<TD><a href="https://www.ihealthinterview.com/hmg/hmgonline.asp" target="_top"><font color="Red">Start Over</font></a><TD>


<%
end if
%>

									</tr>
									</table>
												<%
												if len(strError) <> 0 then
													%>
												<p class="ErrorMessage"><% =strError %></p>
												<%
												end if
												%>

												</table>
											</td>
										</tr>

								</table>

								</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
			<table class="SiteFooter" ID="Table7">
				<tr>
					<td class="SiteFooterText">&#169;2004-2011&nbsp;Primetime Medical Software, Inc. All rights reserved.</td>
				</tr>
			</table>

		</form>
	</body>
</html>
